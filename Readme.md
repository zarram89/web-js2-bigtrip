# Задача 9: Фильтрация и создание точек (module7-task1)

В этом задании мы значительно расширили функциональность приложения, добавив возможность фильтрации, создания и удаления точек маршрута.

## Описание задачи
1.  **Модель данных**:
    *   Добавить методы `updatePoint`, `addPoint`, `deletePoint` в `PointsModel`.
    *   Реализовать паттерн "Наблюдатель" для синхронизации данных.
2.  **Фильтрация**:
    *   Создать `FilterModel` для хранения текущего фильтра.
    *   Создать `FilterPresenter` для управления компонентом фильтров.
    *   Связать изменение фильтра с обновлением списка точек в `BoardPresenter`.
3.  **CRUD (Create, Read, Update, Delete)**:
    *   Реализовать удаление точки через форму редактирования.
    *   Реализовать создание новой точки по кнопке "New Event".
    *   Обеспечить сброс фильтров и сортировки при создании новой точки.
4.  **Безопасность**:
    *   Ограничить ввод пункта назначения списком доступных городов.
    *   Разрешить ввод в поле цены только чисел.

# Решение Задачи 9 (module7-task1)

Для выполнения задачи я выполнил следующие действия:

### 1. Обновление Модели
*   **`PointsModel`**:
    *   Унаследовал от `Observable`.
    *   Реализовал методы `updatePoint`, `addPoint`, `deletePoint`, которые изменяют массив точек и уведомляют подписчиков.
*   **`FilterModel`**:
    *   Создал модель для хранения текущего типа фильтра (`EVERYTHING`, `FUTURE`, `PRESENT`, `PAST`).

### 2. Реализация Фильтрации
*   **`FilterPresenter`**:
    *   Инициализирует `FilterView`.
    *   Подписывается на изменения в `PointsModel` и `FilterModel`.
    *   Пересчитывает количество доступных точек для каждого фильтра.
*   **`BoardPresenter`**:
    *   В геттере `points` теперь применяется текущий фильтр из `FilterModel`.
    *   При изменении фильтра (`UpdateType.MAJOR`) список точек перерисовывается, сортировка сбрасывается.

### 3. Создание и Удаление
*   **`NewPointPresenter`**:
    *   Создал презентер для управления формой создания новой точки.
    *   Обрабатывает сохранение (добавление точки) и отмену (закрытие формы).
*   **`EditPointView`**:
    *   Добавил обработчик для кнопки "Delete".
    *   Добавил валидацию: цена приводится к числу, пункт назначения проверяется на наличие в списке.
*   **`PointPresenter`**:
    *   Связал действия пользователя (`UserAction`) с методами модели через `handleViewAction`.

### 4. Точка входа и Связи
*   В `main.js` инициализировал `FilterModel` и `FilterPresenter`.
*   Настроил кнопку "New Event":
    *   При клике вызывается `boardPresenter.createPoint()`.
    *   Кнопка блокируется, пока открыта форма создания.
    *   Форма закрывается по кнопке "Cancel" или `Esc`, разблокируя кнопку "New Event".

### 5. Проверка
*   Проект собирается без ошибок.
*   Фильтры работают корректно, скрывая пустые категории.
*   Создание новой точки добавляет её в список.
*   Удаление точки убирает её из списка.
*   Редактирование сохраняет изменения.

# Задача 10: Взаимодействие с сервером (module8-task1)

В этом задании мы настроили взаимодействие с сервером для загрузки и обновления данных.

## Описание задачи
1.  **Загрузка данных**:
    *   Создать модуль `PointsApiService` для взаимодействия с REST API.
    *   Реализовать паттерн "Адаптер" для преобразования данных (сервер <-> клиент).
    *   Загружать точки, пункты назначения и офферы при старте приложения.
    *   Показывать сообщение "Loading..." во время загрузки.
2.  **Обновление данных**:
    *   Реализовать метод `updatePoint` в API.
    *   Обновлять данные на сервере перед обновлением модели.
    *   Удалить моковые данные.

# Решение Задачи 10 (module8-task1)

### 1. API Сервис
*   **`PointsApiService`**:
    *   Унаследован от `ApiService`.
    *   Методы `get points`, `get destinations`, `get offers` загружают данные.
    *   Метод `updatePoint` отправляет PUT запрос.
    *   Метод `adaptToServer` преобразует данные в формат сервера (snake_case), удаляя лишние поля клиента.

### 2. Модель и Адаптеры
*   **`PointsModel`**:
    *   Принимает `PointsApiService` в конструктор.
    *   Метод `init` загружает все данные параллельно и уведомляет презентер событием `INIT`.
    *   Метод `adaptToClient` преобразует данные сервера в формат приложения (camelCase).
    *   Метод `updatePoint` сначала ждет ответа от сервера, затем обновляет локальные данные.

### 3. Презентер и View
*   **`LoadingView`**:
    *   Простой компонент с текстом "Loading...".
*   **`BoardPresenter`**:
    *   Показывает `LoadingView` при старте.
    *   При событии `INIT` скрывает лоадер и рисует доску.
    *   Передает реальные `offers` и `destinations` в презентеры точек.

### 4. Исправление ошибок
*   Исправлена ошибка `400 Bad Request` при обновлении точки:
    *   `PointView` больше не мутирует объект точки (не добавляет `destinationName`).
    *   `PointsApiService` отправляет только необходимые поля, исключая лишние свойства.

### 5. Удаление моков
*   Директория `src/mock` удалена.
*   Все компоненты используют данные, полученные с сервера.
